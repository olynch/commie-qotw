<html>
	<head>
		<link href = '/Flat-UI/dist/css/vendor/bootstrap.min.css' rel = 'stylesheet' />
		<link href = '/Flat-UI/dist/css/flat-ui.min.css' rel = 'stylesheet' />
		<link href = '/css/stylesheet.css' rel = 'stylesheet' />
		<script src = '/js/jquery.js'></script>
		<script src = '/js/nav.js'></script>
		<title>QOTW</title>
		<script>
			function formatDate(date) {
				return ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'][date.getDay()] + ' ' + ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'][date.getMonth()] + ' ' + String(date.getDate()) + ', ' + String(date.getFullYear()) + ' at ' + String(date.getHours()) + ':' + String(date.getMinutes());
			}
			var lastMessage;
			$.ajax({
				'url': '/fetch/lastmessage',
				'dataType': 'json',
				'success': function(response) {
					lastMessage.children('div.panel-heading').text(response.title + ' (' + formatDate(new Date(response.timestamp)) + ')');
					lastMessage.children('div.panel-body').html(response.body.replace(/\n/g, '<br />'));
				}
			});
			$(document).ready(function() {
				lastMessage = $('div#last-message');
				$('textarea#quote').keyup(function(e) {
					if (e.which == 13) submit();
					else {
						if ($(this).val()) $('button#submit').removeClass('btn-default').addClass('btn-success');
						else $('button#submit').removeClass('btn-success').addClass('btn-default');
					}
				});
				function submit() {
					if (!$('button#submit').hasClass('btn-success')) return;
					$('button#submit').removeClass('btn-success').addClass('btn-warning');
					$.ajax({
						'url': '/post/submit',
						'type': 'POST',
						'data': {
							'quote': $('textarea#quote').val()
						},
						'dataType': 'json',
						'success': function(response) {
							if (response.success) $('button#submit').removeClass('btn-warning').addClass('btn-success');
							else $('button#submit').removeClass('btn-warning').addClass('btn-danger');
						},
						'error': function() {
							$('button#submit').removeClass('btn-warning').addClass('btn-danger');
							setTimeout(function() {
								$('button#submit').removeClass('btn-danger').addClass('btn-default');
							}, 1000);
						}
					});
					$('textarea#quote').val('');
				}
				$('button#submit').click(submit);
			});
		</script>
	</head>
	<body>
		<div id = 'body'>
			<div class = 'row'>
				<div class = 'col-md-6'>
					<div class = 'panel panel-default'>
						<div class = 'panel-heading'>Submit</div>
						<div class = 'panel-body'>
							<textarea id = 'quote' class = 'form-control' placeholder = 'Quote' rows = 5></textarea>
							<button id = 'submit' class = 'btn btn-default'>Submit</button>
						</div>
					</div>
				</div>
				<div class = 'col-md-6'>
					<div id = 'last-message' class = 'panel panel-default'>
						<div class = 'panel-heading'>Last post</div>
						<div class = 'panel-body'>Loading...</div>
					</div>
				</div>
			</div>
		</div>
	</body>
</html>